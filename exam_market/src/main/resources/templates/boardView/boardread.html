<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="UTF-8">
<title>판매 정보</title>
<script th:src="@{/js/jquery-3.6.0.js}"></script>
<script>
$(document).ready(function(){
	init();
});

function init(){
	$.ajax({
		url: "replylist",
		type: "get",
		dataType: "json",
		success: function(replylist){
			let str = '<table>';
			$(replylist).each(function(i,item){
				str += '<tr>';
				str += '<td>' + item.memberid + '</td>';
				str += '<td>' + item.replytext + '</td>';
				str += '<td>' + item.inputdate + '</td>';
				str += '</tr>';
			});
			str += '</table>';
			$('#replylist').html(str);
		}
	});
}

function deleteBoard(boardnum){
	let result = confirm("삭제하시겠습니까?");
	if(result == true){
		$.ajax({
			url: 'deleteBoard?boardnum',
			type: 'get',
			data: {boardnum : 'boardnum'},
			success: function(){},	
			error: function(e){
				alert('에러가 발생하였습니다.');
			}						
		});				
	}
	}

function buyBoard(boardnum){
	let result = confirm("구매하시겠습니까?");
	if(result == true){
		$.ajax({
			url: 'buyBoard?boardnum',
			type: 'get',
			data: {boardnum : 'boardnum'},
			success: function(){},	
			error: function(e){
				alert('에러가 발생하였습니다.');
			}						
		});				
	}
}
	
</script>
</head>
<body>
	<h1>[ 판매 정보 ]</h1>
	
		<div id="readBoard" th:each="b : ${board}">
			<table>
				<tr>
		            <th>작성자</th>
		            <td th:text="${b.memberid}"></td>
				</tr>
				<tr>
		            <th>작성일</th>
		            <td th:text="${b.inputdate}"></td>
		        </tr>
				<tr>
		            <th>제목</th>
		            <td th:text="${b.title}"></td>
				</tr>
				<tr>
					<th>내용</th>	
					<td th:text="${b.contents}"></td>			
				</tr>
				<tr>
					<td colspan="2">
						<span th:if="${#authentication.name} == ${b.memberid}">
							<a th:href="|javascript:deleteBoard(boardnum=${b.boardnum})|">
								<button class="bottom">삭제</button>
						   </a>				   
						</span>
						<span th:if="${#authentication.name} != ${b.memberid}">
							<a th:href="|javascript:buyBoard(boardnum=${b.boardnum})|">
								<button class="bottom">구매하기</button>
						   </a>				   
						</span>
					</td>
				</tr>
			</table>
			
			<form th:action="@{/board/writeReply}" method="post">
			<input type="text" name="replytext" id="replytext">
			<input type="hidden" name="boardnum" th:value="${b.boardnum}">&nbsp;
			<input type="submit" value="확인"><br><br>
			</form>
			<br>
			<div id="replylist">
					
			</div>
		</div>
</body>
</html>